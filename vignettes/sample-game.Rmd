---
title: "Sample Game"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Intro

This just shows a brief example of how you can start a game and trigger turns to progress.

```{r, include=FALSE}
devtools::load_all()
fs::dir_delete(file.path(GAME_ROOT_DIR, "anno_uno"))
```
```{r}
library(MundusCentrum)
```

### Setup the game

```{r}
game <- new_game(
  name = "Anno Uno",
  players = list(
    list(
      name = "Big Grizz",
      team = "Space Marines",
      units = system.file("extdata", "unit-templates", "big_grizz.csv", package = "MundusCentrum")
    ),
    list(
      name = "Eric",
      team = "Space Orcs",
      units = system.file("extdata", "unit-templates", "eric.csv", package = "MundusCentrum")
    ),
    list(
      name = "Chris",
      team = "Tyrannids",
      units = system.file("extdata", "unit-templates", "chris.csv", package = "MundusCentrum")
    )
  ),
  points = 2000
)
```

### see the starting point
This is the state of the game at the beginning

```{r}
reconcile_player_orders(game) %>% 
  knitr::kable()
```

## Turn play

Get a list of unit ID's to easily make the `move_unit()` calls below.

```{r}
moby_units <- read_player_map(game, "big_grizz") %>% pull(unit_uuid)
eric_units <- read_player_map(game, "eric") %>% pull(unit_uuid)
chris_units <- read_player_map(game, "chris") %>% pull(unit_uuid)
```

# TURN 1
Players change their maps (making orders)

```{r}
move_unit(game, "big_grizz", moby_units[1], "move", "A1", "D1")
move_unit(game, "big_grizz", moby_units[2], "move", "A1", "D1")
move_unit(game, "big_grizz", moby_units[3], "move", "A1", "D1")
move_unit(game, "eric",      eric_units[1], "move", "C1", "E1")
move_unit(game, "eric",      eric_units[2], "move", "C1", "E1")
move_unit(game, "eric",      eric_units[3], "move", "C1", "E1")
move_unit(game, "chris",     chris_units[7], "sneak","F3", "E4")
move_unit(game, "chris",     chris_units[8], "soar","F4", "G4")
```

Attempt to reconcile moves.

```{r}
reconcile_player_orders(game) %>% 
  knitr::kable()
```

We're good! Move on to the next turn.

# TURN 2
Players change their maps (making orders)

```{r}
move_unit(game, "big_grizz", moby_units[1], "attack", "D1", "F1")
move_unit(game, "big_grizz", moby_units[2], "attack", "D1", "F1")
move_unit(game, "big_grizz", moby_units[3], "attack", "D1", "F1")
move_unit(game, "eric",      eric_units[1], "attack", "E1", "F2")
move_unit(game, "eric",      eric_units[2], "attack", "E1", "F2")
move_unit(game, "eric",      eric_units[3], "attack", "E4", "F2")
move_unit(game, "chris",     chris_units[8], "sneak","E4", "E2")
move_unit(game, "chris",     chris_units[8], "soar","F4", "D4")
```

Attempt to reconcile moves.

```{r}
reconcile_player_orders(game) %>% 
  knitr::kable()
```

### Fights are resolved
This is where the players would resolved fights however they see fit (e.g. Warhammer, chessboxing, what-have-you)

Then they adjust their maps accordingly for the outcome of the conflicts.

```{r}
move_unit(game, "eric",      eric_units[1], "retreat", "F2", "E7")
move_unit(game, "eric",      eric_units[2], "retreat", "F2", "E7")
move_unit(game, "eric",      eric_units[3], "retreat", "F2", "E7")
move_unit(game, "chris",     chris_units[1], "retreat","F1", "F2")
move_unit(game, "chris",     chris_units[2], "retreat","F1", "F2")
```

Now we reconcile again.

```{r}
reconcile_player_orders(game) %>% 
  knitr::kable()
```

We're good. On to turn 3.

# TURN 3
Players change their maps (making orders)...


